<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Tech Handbook</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='docs_theme.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
    <script>
        // Fallback if markdown-it fails to load
        window.addEventListener('load', function() {
            if (typeof markdownit === 'undefined') {
                console.warn('markdown-it library not loaded. Preview will use basic HTML escaping.');
            }
        });
    </script>
</head>
<body>
    <div class="shell">
        <header class="topbar" role="banner">
            <div class="topbar-inner">
                <button id="sidebarToggle" class="btn-icon" aria-controls="sidebar" aria-expanded="false"
                    title="Toggle sidebar (Ctrl+B)">
                    <!-- Hamburger icon -->
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true">
                        <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" />
                    </svg>
                </button>

                <a href="/" class="brand" aria-label="Landing Page">
                    <img src="/media/logo.png" alt="ontheedge">
                    <span class="name">Tech Handbook</span>
                </a>

                <div class="nav-links">
                    <a href="{{ url_for('docs_landing') }}" class="nav-link">Documentation</a>
                    <a href="#" class="nav-link">Resources</a>
                    <a href="#" class="nav-link">Community</a>
                </div>

                <div class="search-container">
                    <input id="searchInput" type="search" class="search-input" placeholder="Search docs‚Ä¶ (Ctrl+/)" autocomplete="off" />
                    <div class="search-results-container" id="topSearchResults"></div>
                </div>
                
                <div class="auth-links">
                    <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
                </div>
            </div>
        </header>

        <div class="admin-layout">
            <!-- Sidebar -->
            <div class="admin-sidebar">
                <div class="admin-sidebar-header">
                    <h3>Administration</h3>
                </div>
                <div class="admin-sidebar-nav">
                    <div class="admin-sidebar-nav-item active" data-tab="dashboard">
                        <i>üìä</i>
                        <span>Dashboard</span>
                    </div>
                    <div class="admin-sidebar-nav-item" data-tab="courses">
                        <i>üìö</i>
                        <span>Courses</span>
                    </div>
                    <div class="admin-sidebar-nav-item" data-tab="documents">
                        <i>üìÑ</i>
                        <span>Documents</span>
                    </div>
                    <div class="admin-sidebar-nav-item" data-tab="settings">
                        <i>‚öôÔ∏è</i>
                        <span>Settings</span>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="admin-main">
                <div class="admin-topbar">
                    <div class="admin-topbar-left">
                        <h2>Admin Dashboard</h2>
                    </div>
                    <div class="admin-topbar-right">
                        <div class="admin-user-info">
                            <div class="admin-user-avatar">A</div>
                            <div>
                                <div>Admin User</div>
                                <div style="font-size: 0.8rem; color: var(--text-tertiary);">Administrator</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-dashboard">
                    <!-- Dashboard Tab -->
                    <div class="admin-tab-content active" id="dashboard-tab">
                        <div class="admin-stats-grid">
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon courses">
                                    üìö
                                </div>
                                <div class="admin-stat-content">
                                    <h3 id="total-courses">{{ total_courses or 0 }}</h3>
                                    <p>Total Courses</p>
                                </div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon documents">
                                    üìÑ
                                </div>
                                <div class="admin-stat-content">
                                    <h3 id="total-documents">{{ total_documents or 0 }}</h3>
                                    <p>Total Documents</p>
                                </div>
                            </div>
                        </div>

                        <div class="admin-grid admin-grid-2">
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3>Recent Activity</h3>
                                </div>
                                <div class="admin-card-body">
                                    <p>No recent activity</p>
                                </div>
                            </div>
                            
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3>Quick Actions</h3>
                                </div>
                                <div class="admin-card-body">
                                    <div class="d-flex gap-10" style="flex-wrap: wrap;">
                                        <button class="admin-btn admin-btn-primary" id="new-course-action">
                                            <i>‚ûï</i> New Course
                                        </button>
                                        <button class="admin-btn admin-btn-secondary" id="manage-courses-action">
                                            <i>üìã</i> Manage Courses
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Courses Tab -->
                    <div class="admin-tab-content" id="courses-tab">
                        <div class="admin-content">
                            <div class="admin-content-header">
                                <h3>Courses Management</h3>
                                <button class="admin-btn admin-btn-primary" id="new-course-btn">
                                    <i>‚ûï</i> Add New Course
                                </button>
                            </div>
                            <div class="admin-content-body">
                                <div class="admin-form-group mb-20">
                                    <input type="text" class="admin-form-control" id="course-search" placeholder="Search courses...">
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Course Name</th>
                                                <th>Description</th>
                                                <th>Documents</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="courses-table-body">
                                            {% if courses %}
                                                {% for course in courses %}
                                                <tr data-course="{{ course.name }}" draggable="true" class="draggable-course">
                                                    <td>
                                                        <span class="drag-handle" style="cursor: move; margin-right: 10px;">‚ãÆ‚ãÆ</span>
                                                        {{ course.name }}
                                                    </td>
                                                    <td>{{ course.description or "No description" }}</td>
                                                    <td><span class="admin-badge admin-badge-primary">{{ course.document_count or 0 }}</span></td>
                                                    <td>
                                                        <div class="admin-table-actions">
                                                            <button class="admin-btn admin-btn-sm admin-btn-secondary edit-course" data-name="{{ course.name }}">
                                                                <i>‚úèÔ∏è</i> Edit
                                                            </button>
                                                            <button class="admin-btn admin-btn-sm admin-btn-danger delete-course" data-name="{{ course.name }}">
                                                                <i>üóëÔ∏è</i> Delete
                                                            </button>
                                                            <button class="admin-btn admin-btn-sm admin-btn-success manage-docs" data-name="{{ course.name }}">
                                                                <i>üìÑ</i> Docs
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="4" class="text-center">No courses found</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Tab -->
                    <div class="admin-tab-content" id="documents-tab">
                        <div class="admin-content">
                            <div class="admin-content-header">
                                <h3>Documents Management</h3>
                                <div class="d-flex gap-10 align-center">
                                    <select class="admin-form-control" id="document-course-selector" style="width: 200px;">
                                        <option value="">Select Course</option>
                                        {% for course in courses %}
                                        <option value="{{ course.name }}">{{ course.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <button class="admin-btn admin-btn-primary" id="new-document-btn" disabled>
                                        <i>‚ûï</i> Add Document
                                    </button>
                                </div>
                            </div>
                            <div class="admin-content-body">
                                <div class="admin-form-group mb-20">
                                    <input type="text" class="admin-form-control" id="document-search" placeholder="Search documents...">
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Document Name</th>
                                                <th>Course</th>
                                                <th>Last Modified</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="documents-table-body">
                                            <tr>
                                                <td colspan="4" class="text-center">Select a course to view documents</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Drag and drop area for importing documents -->
                                <div class="admin-card mt-20">
                                    <div class="admin-card-header">
                                        <h3>Bulk Import Documents</h3>
                                    </div>
                                    <div class="admin-card-body">
                                        <div id="drop-area" class="drop-area">
                                            <p>Drag and drop Markdown files here or click to select files</p>
                                            <input type="file" id="file-input" multiple accept=".md" style="display: none;">
                                            <button class="admin-btn admin-btn-secondary" id="browse-files">Browse Files</button>
                                        </div>
                                        <div id="import-progress" class="mt-20" style="display: none;">
                                            <div class="loading-spinner" style="margin: 10px auto;"></div>
                                            <p>Importing documents...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="admin-tab-content" id="settings-tab">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h3>System Settings</h3>
                            </div>
                            <div class="admin-card-body">
                                <div class="admin-alert admin-alert-info">
                                    <i>‚ÑπÔ∏è</i>
                                    <div>Settings management is not implemented in this version.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer" role="contentinfo">
            <div class="footer-inner">
                <a href="/" class="brand-mini">
                    <img src="/media/logo.png" alt="ontheedge">
                    <span>OnTheEdge Tech</span>
                </a>
                <div>
                    <a href="https://github.com/OntheEdgeTech" class="nav-link">GitHub</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Course Modal -->
    <div class="admin-modal" id="course-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 id="course-modal-title">Add New Course</h3>
                <button class="admin-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="course-form">
                    <input type="hidden" id="course-id">
                    <div class="admin-form-group">
                        <label for="course-name">Course Name *</label>
                        <input type="text" class="admin-form-control" id="course-name" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="course-description">Description</label>
                        <textarea class="admin-form-control" id="course-description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="course-modal-close">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="course-modal-save">Save Course</button>
            </div>
        </div>
    </div>

    <!-- Document Modal -->
    <div class="admin-modal" id="document-modal">
        <div class="admin-modal-content" style="max-width: 900px; width: 90%;">
            <div class="admin-modal-header">
                <h3 id="document-modal-title">Add New Document</h3>
                <button class="admin-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="document-form">
                    <input type="hidden" id="document-id">
                    <input type="hidden" id="document-course">
                    <div class="admin-form-group">
                        <label for="document-name">Document Name *</label>
                        <input type="text" class="admin-form-control" id="document-name" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="document-content">Content *</label>
                        <div class="editor-container">
                            <div class="editor-toolbar">
                                <button type="button" class="editor-btn" data-command="bold" title="Bold (Ctrl+B)">ùêÅ</button>
                                <button type="button" class="editor-btn" data-command="italic" title="Italic (Ctrl+I)">ùêº</button>
                                <button type="button" class="editor-btn" data-command="heading" title="Heading (Ctrl+H)">H</button>
                                <button type="button" class="editor-btn" data-command="link" title="Link (Ctrl+K)">üîó</button>
                                <button type="button" class="editor-btn" data-command="image" title="Image">üñºÔ∏è</button>
                                <button type="button" class="editor-btn" data-command="code" title="Code Block">{}
                                </button>
                                <button type="button" class="editor-btn" data-command="quote" title="Quote">‚ùù</button>
                                <button type="button" class="editor-btn" data-command="list-ul" title="Bullet List">‚Ä¢</button>
                                <button type="button" class="editor-btn" data-command="list-ol" title="Numbered List">1.</button>
                                <button type="button" class="editor-btn" data-command="hr" title="Horizontal Rule">‚Äï</button>
                                <button type="button" class="editor-btn preview-toggle" id="preview-toggle" title="Toggle Preview">üëÅÔ∏è</button>
                                <button type="button" class="editor-btn edit-toggle" id="edit-toggle" title="Edit Document" style="display: none;">‚úèÔ∏è</button>
                            </div>
                            <div class="editor-content">
                                <textarea class="admin-form-control editor-textarea" id="document-content" required></textarea>
                                <div class="editor-preview" id="editor-preview"></div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="document-modal-close">Cancel</button>
                <button class="admin-btn admin-btn-secondary" id="edit-document-btn" style="display: none;">Edit</button>
                <button class="admin-btn admin-btn-primary" id="document-modal-save">Save Document</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script src="{{ url_for('static', filename='admin.js') }}"></script>

</body>
</html>