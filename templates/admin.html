<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Tech Handbook</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='docs_theme.css') }}">
</head>
<body>
    <div class="shell">
        <header class="topbar" role="banner">
            <div class="topbar-inner">
                <button id="sidebarToggle" class="btn-icon" aria-controls="sidebar" aria-expanded="false"
                    title="Toggle sidebar (Ctrl+B)">
                    <!-- Hamburger icon -->
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true">
                        <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" />
                    </svg>
                </button>

                <a href="/" class="brand" aria-label="Landing Page">
                    <img src="/media/logo.png" alt="ontheedge">
                    <span class="name">Tech Handbook</span>
                </a>

                <div class="nav-links">
                    <a href="{{ url_for('docs_landing') }}" class="nav-link">Documentation</a>
                    <a href="#" class="nav-link">Resources</a>
                    <a href="#" class="nav-link">Community</a>
                </div>

                <div class="search-container">
                    <input id="searchInput" type="search" class="search-input" placeholder="Search docs‚Ä¶ (Ctrl+/)" autocomplete="off" />
                    <div class="search-results-container" id="topSearchResults"></div>
                </div>
                
                <div class="auth-links">
                    <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
                </div>
            </div>
        </header>

        <div class="admin-layout">
            <!-- Sidebar -->
            <div class="admin-sidebar">
                <div class="admin-sidebar-header">
                    <h3>Administration</h3>
                </div>
                <div class="admin-sidebar-nav">
                    <div class="admin-sidebar-nav-item active" data-tab="dashboard">
                        <i>üìä</i>
                        <span>Dashboard</span>
                    </div>
                    <div class="admin-sidebar-nav-item" data-tab="courses">
                        <i>üìö</i>
                        <span>Courses</span>
                    </div>
                    <div class="admin-sidebar-nav-item" data-tab="documents">
                        <i>üìÑ</i>
                        <span>Documents</span>
                    </div>
                    <div class="admin-sidebar-nav-item" data-tab="settings">
                        <i>‚öôÔ∏è</i>
                        <span>Settings</span>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="admin-main">
                <div class="admin-topbar">
                    <div class="admin-topbar-left">
                        <h2>Admin Dashboard</h2>
                    </div>
                    <div class="admin-topbar-right">
                        <div class="admin-user-info">
                            <div class="admin-user-avatar">A</div>
                            <div>
                                <div>Admin User</div>
                                <div style="font-size: 0.8rem; color: var(--text-tertiary);">Administrator</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-dashboard">
                    <!-- Dashboard Tab -->
                    <div class="admin-tab-content active" id="dashboard-tab">
                        <div class="admin-stats-grid">
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon courses">
                                    üìö
                                </div>
                                <div class="admin-stat-content">
                                    <h3 id="total-courses">{{ total_courses or 0 }}</h3>
                                    <p>Total Courses</p>
                                </div>
                            </div>
                            <div class="admin-stat-card">
                                <div class="admin-stat-icon documents">
                                    üìÑ
                                </div>
                                <div class="admin-stat-content">
                                    <h3 id="total-documents">{{ total_documents or 0 }}</h3>
                                    <p>Total Documents</p>
                                </div>
                            </div>
                        </div>

                        <div class="admin-grid admin-grid-2">
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3>Recent Activity</h3>
                                </div>
                                <div class="admin-card-body">
                                    <p>No recent activity</p>
                                </div>
                            </div>
                            
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3>Quick Actions</h3>
                                </div>
                                <div class="admin-card-body">
                                    <div class="d-flex gap-10" style="flex-wrap: wrap;">
                                        <button class="admin-btn admin-btn-primary" id="new-course-action">
                                            <i>‚ûï</i> New Course
                                        </button>
                                        <button class="admin-btn admin-btn-secondary" id="manage-courses-action">
                                            <i>üìã</i> Manage Courses
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Courses Tab -->
                    <div class="admin-tab-content" id="courses-tab">
                        <div class="admin-content">
                            <div class="admin-content-header">
                                <h3>Courses Management</h3>
                                <button class="admin-btn admin-btn-primary" id="new-course-btn">
                                    <i>‚ûï</i> Add New Course
                                </button>
                            </div>
                            <div class="admin-content-body">
                                <div class="admin-form-group mb-20">
                                    <input type="text" class="admin-form-control" id="course-search" placeholder="Search courses...">
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Course Name</th>
                                                <th>Description</th>
                                                <th>Documents</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="courses-table-body">
                                            {% if courses %}
                                                {% for course in courses %}
                                                <tr data-course="{{ course.name }}" draggable="true" class="draggable-course">
                                                    <td>
                                                        <span class="drag-handle" style="cursor: move; margin-right: 10px;">‚ãÆ‚ãÆ</span>
                                                        {{ course.name }}
                                                    </td>
                                                    <td>{{ course.description or "No description" }}</td>
                                                    <td><span class="admin-badge admin-badge-primary">{{ course.document_count or 0 }}</span></td>
                                                    <td>
                                                        <div class="admin-table-actions">
                                                            <button class="admin-btn admin-btn-sm admin-btn-secondary edit-course" data-name="{{ course.name }}">
                                                                <i>‚úèÔ∏è</i> Edit
                                                            </button>
                                                            <button class="admin-btn admin-btn-sm admin-btn-danger delete-course" data-name="{{ course.name }}">
                                                                <i>üóëÔ∏è</i> Delete
                                                            </button>
                                                            <button class="admin-btn admin-btn-sm admin-btn-success manage-docs" data-name="{{ course.name }}">
                                                                <i>üìÑ</i> Docs
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="4" class="text-center">No courses found</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Tab -->
                    <div class="admin-tab-content" id="documents-tab">
                        <div class="admin-content">
                            <div class="admin-content-header">
                                <h3>Documents Management</h3>
                                <div class="d-flex gap-10 align-center">
                                    <select class="admin-form-control" id="document-course-selector" style="width: 200px;">
                                        <option value="">Select Course</option>
                                        {% for course in courses %}
                                        <option value="{{ course.name }}">{{ course.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <button class="admin-btn admin-btn-primary" id="new-document-btn" disabled>
                                        <i>‚ûï</i> Add Document
                                    </button>
                                </div>
                            </div>
                            <div class="admin-content-body">
                                <div class="admin-form-group mb-20">
                                    <input type="text" class="admin-form-control" id="document-search" placeholder="Search documents...">
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Document Name</th>
                                                <th>Course</th>
                                                <th>Last Modified</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="documents-table-body">
                                            <tr>
                                                <td colspan="4" class="text-center">Select a course to view documents</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Drag and drop area for importing documents -->
                                <div class="admin-card mt-20">
                                    <div class="admin-card-header">
                                        <h3>Bulk Import Documents</h3>
                                    </div>
                                    <div class="admin-card-body">
                                        <div id="drop-area" class="drop-area">
                                            <p>Drag and drop Markdown files here or click to select files</p>
                                            <input type="file" id="file-input" multiple accept=".md" style="display: none;">
                                            <button class="admin-btn admin-btn-secondary" id="browse-files">Browse Files</button>
                                        </div>
                                        <div id="import-progress" class="mt-20" style="display: none;">
                                            <div class="loading-spinner" style="margin: 10px auto;"></div>
                                            <p>Importing documents...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="admin-tab-content" id="settings-tab">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h3>System Settings</h3>
                            </div>
                            <div class="admin-card-body">
                                <div class="admin-alert admin-alert-info">
                                    <i>‚ÑπÔ∏è</i>
                                    <div>Settings management is not implemented in this version.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer" role="contentinfo">
            <div class="footer-inner">
                <a href="/" class="brand-mini">
                    <img src="/media/logo.png" alt="ontheedge">
                    <span>OnTheEdge Tech</span>
                </a>
                <div>
                    <a href="https://github.com/OntheEdgeTech" class="nav-link">GitHub</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Course Modal -->
    <div class="admin-modal" id="course-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 id="course-modal-title">Add New Course</h3>
                <button class="admin-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="course-form">
                    <input type="hidden" id="course-id">
                    <div class="admin-form-group">
                        <label for="course-name">Course Name *</label>
                        <input type="text" class="admin-form-control" id="course-name" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="course-description">Description</label>
                        <textarea class="admin-form-control" id="course-description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="course-modal-close">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="course-modal-save">Save Course</button>
            </div>
        </div>
    </div>

    <!-- Document Modal -->
    <div class="admin-modal" id="document-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 id="document-modal-title">Add New Document</h3>
                <button class="admin-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="document-form">
                    <input type="hidden" id="document-id">
                    <input type="hidden" id="document-course">
                    <div class="admin-form-group">
                        <label for="document-name">Document Name *</label>
                        <input type="text" class="admin-form-control" id="document-name" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="document-content">Content *</label>
                        <textarea class="admin-form-control" id="document-content" rows="10" required></textarea>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="document-modal-close">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="document-modal-save">Save Document</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script>
        // Admin Panel Functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            const tabItems = document.querySelectorAll('.admin-sidebar-nav-item');
            const tabContents = document.querySelectorAll('.admin-tab-content');
            
            tabItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    tabItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show active content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabName + '-tab') {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Modal functionality
            const modals = document.querySelectorAll('.admin-modal');
            const closeButtons = document.querySelectorAll('.admin-modal-close');
            const cancelButtons = document.querySelectorAll('[id$="-modal-close"]');
            
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.admin-modal').style.display = 'none';
                });
            });
            
            cancelButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.admin-modal').style.display = 'none';
                });
            });
            
            window.addEventListener('click', function(event) {
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // Course search
            const courseSearch = document.getElementById('course-search');
            if (courseSearch) {
                courseSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const rows = document.querySelectorAll('#courses-table-body tr');
                    
                    rows.forEach(row => {
                        const courseName = row.cells[0].textContent.toLowerCase();
                        const description = row.cells[1].textContent.toLowerCase();
                        
                        if (courseName.includes(searchTerm) || description.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
            }
            
            // Document search
            const documentSearch = document.getElementById('document-search');
            if (documentSearch) {
                documentSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const rows = document.querySelectorAll('#documents-table-body tr');
                    
                    rows.forEach(row => {
                        if (row.cells) {
                            const docName = row.cells[0].textContent.toLowerCase();
                            if (docName.includes(searchTerm)) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        }
                    });
                });
            }
            
            // Course selector for documents
            const documentCourseSelector = document.getElementById('document-course-selector');
            const newDocumentBtn = document.getElementById('new-document-btn');
            
            documentCourseSelector.addEventListener('change', function() {
                newDocumentBtn.disabled = !this.value;
                if (this.value) {
                    loadDocuments(this.value);
                } else {
                    document.getElementById('documents-table-body').innerHTML = 
                        '<tr><td colspan="4" class="text-center">Select a course to view documents</td></tr>';
                }
            });
            
            // Button actions
            document.getElementById('new-course-btn').addEventListener('click', function() {
                document.getElementById('course-modal-title').textContent = 'Add New Course';
                document.getElementById('course-form').reset();
                document.getElementById('course-id').value = '';
                document.getElementById('course-modal').style.display = 'flex';
            });
            
            document.getElementById('new-course-action').addEventListener('click', function() {
                document.querySelector('.admin-sidebar-nav-item[data-tab="courses"]').click();
                document.getElementById('new-course-btn').click();
            });
            
            document.getElementById('manage-courses-action').addEventListener('click', function() {
                document.querySelector('.admin-sidebar-nav-item[data-tab="courses"]').click();
            });
            
            document.getElementById('new-document-btn').addEventListener('click', function() {
                if (!documentCourseSelector.value) return;
                
                document.getElementById('document-modal-title').textContent = 'Add New Document';
                document.getElementById('document-form').reset();
                document.getElementById('document-id').value = '';
                document.getElementById('document-course').value = documentCourseSelector.value;
                document.getElementById('document-modal').style.display = 'flex';
            });
            
            // Edit course buttons
            document.querySelectorAll('.edit-course').forEach(button => {
                button.addEventListener('click', function() {
                    const courseName = this.getAttribute('data-name');
                    
                    // Switch to courses tab
                    document.querySelector('.admin-sidebar-nav-item[data-tab="courses"]').click();
                    
                    // Fill form
                    document.getElementById('course-modal-title').textContent = 'Edit Course';
                    document.getElementById('course-name').value = courseName;
                    document.getElementById('course-id').value = courseName;
                    
                    // Try to get description
                    fetch('/api/courses')
                    .then(response => response.json())
                    .then(courses => {
                        const course = courses.find(c => c.name === courseName);
                        if (course) {
                            document.getElementById('course-description').value = course.description || '';
                        }
                    });
                    
                    document.getElementById('course-modal').style.display = 'flex';
                });
            });
            
            // Delete course buttons
            document.querySelectorAll('.delete-course').forEach(button => {
                button.addEventListener('click', function() {
                    const courseName = this.getAttribute('data-name');
                    
                    if (confirm(`Are you sure you want to delete the course "${courseName}" and all its documents?`)) {
                        fetch(`/api/courses/${encodeURIComponent(courseName)}`, {
                            method: 'DELETE'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.message) {
                                // Remove row from table
                                document.querySelector(`tr[data-course="${courseName}"]`).remove();
                                updateStats();
                                showToast('Course deleted successfully', 'success');
                            } else {
                                showToast('Error: ' + (data.error || 'Could not delete course'), 'error');
                            }
                        })
                        .catch(error => {
                            showToast('Error: ' + error.message, 'error');
                        });
                    }
                });
            });
            
            // Manage documents buttons
            document.querySelectorAll('.manage-docs').forEach(button => {
                button.addEventListener('click', function() {
                    const courseName = this.getAttribute('data-name');
                    
                    // Switch to documents tab
                    document.querySelector('.admin-sidebar-nav-item[data-tab="documents"]').click();
                    
                    // Set course selector
                    documentCourseSelector.value = courseName;
                    newDocumentBtn.disabled = false;
                    
                    // Load documents
                    loadDocuments(courseName);
                });
            });
            
            // Save course
            document.getElementById('course-modal-save').addEventListener('click', function() {
                const courseName = document.getElementById('course-name').value;
                const description = document.getElementById('course-description').value;
                const courseId = document.getElementById('course-id').value;
                
                if (!courseName) {
                    showToast('Course name is required', 'error');
                    return;
                }
                
                const isUpdate = !!courseId && courseId !== courseName;
                
                if (isUpdate) {
                    if (confirm(`This will delete the course "${courseId}" and create a new course "${courseName}". Continue?`)) {
                        // Delete old course
                        fetch(`/api/courses/${encodeURIComponent(courseId)}`, {
                            method: 'DELETE'
                        })
                        .then(response => {
                            if (response.ok) {
                                // Create new course
                                return fetch('/api/courses', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        name: courseName,
                                        description: description
                                    })
                                });
                            } else {
                                throw new Error('Failed to delete old course');
                            }
                        })
                        .then(response => response.json())
                        .then(result => {
                            if (result.message) {
                                location.reload();
                            } else {
                                showToast('Error: ' + (result.error || 'Could not update course'), 'error');
                            }
                        })
                        .catch(error => {
                            showToast('Error: ' + error.message, 'error');
                        });
                    }
                } else {
                    // Create new course
                    fetch('/api/courses', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: courseName,
                            description: description
                        })
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.message) {
                            location.reload();
                        } else {
                            showToast('Error: ' + (result.error || 'Could not create course'), 'error');
                        }
                    })
                    .catch(error => {
                        showToast('Error: ' + error.message, 'error');
                    });
                }
            });
            
            // Save document
            document.getElementById('document-modal-save').addEventListener('click', function() {
                const documentName = document.getElementById('document-name').value;
                const content = document.getElementById('document-content').value;
                const courseName = document.getElementById('document-course').value;
                
                if (!documentName || !content || !courseName) {
                    showToast('All fields are required', 'error');
                    return;
                }
                
                // Ensure .md extension
                const filename = documentName.endsWith('.md') ? documentName : documentName + '.md';
                
                fetch(`/api/courses/${encodeURIComponent(courseName)}/documents`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        filename: filename,
                        content: content
                    })
                })
                .then(response => response.json())
                .then(result => {
                    if (result.message) {
                        document.getElementById('document-modal').style.display = 'none';
                        loadDocuments(courseName);
                        showToast('Document saved successfully', 'success');
                    } else {
                        showToast('Error: ' + (result.error || 'Could not save document'), 'error');
                    }
                })
                .catch(error => {
                    showToast('Error: ' + error.message, 'error');
                });
            });
            
            // Load documents for a course
            function loadDocuments(courseName) {
                // Show loading spinner
                document.getElementById('documents-table-body').innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center">
                            <div class="loading-spinner" style="margin: 20px auto;"></div>
                        </td>
                    </tr>
                `;
                
                fetch(`/api/courses/${encodeURIComponent(courseName)}/documents`)
                .then(response => response.json())
                .then(documents => {
                    const tbody = document.getElementById('documents-table-body');
                    
                    if (documents.length > 0) {
                        let html = '';
                        documents.forEach(doc => {
                            const filename = doc.filename.replace(/\.md$/, '');
                            html += `
                            <tr>
                                <td>${filename}</td>
                                <td>${courseName}</td>
                                <td>Just now</td>
                                <td>
                                    <div class="admin-table-actions">
                                        <button class="admin-btn admin-btn-sm admin-btn-secondary edit-doc" data-filename="${doc.filename}" data-course="${courseName}">
                                            <i>‚úèÔ∏è</i> Edit
                                        </button>
                                        <button class="admin-btn admin-btn-sm admin-btn-danger delete-doc" data-filename="${doc.filename}" data-course="${courseName}">
                                            <i>üóëÔ∏è</i> Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>`;
                        });
                        tbody.innerHTML = html;
                        
                        // Add event listeners
                        tbody.querySelectorAll('.edit-doc').forEach(button => {
                            button.addEventListener('click', function() {
                                const filename = this.getAttribute('data-filename');
                                const course = this.getAttribute('data-course');
                                editDocument(course, filename);
                            });
                        });
                        
                        tbody.querySelectorAll('.delete-doc').forEach(button => {
                            button.addEventListener('click', function() {
                                const filename = this.getAttribute('data-filename');
                                const course = this.getAttribute('data-course');
                                deleteDocument(course, filename);
                            });
                        });
                    } else {
                        tbody.innerHTML = '<tr><td colspan="4" class="text-center">No documents found</td></tr>';
                    }
                })
                .catch(error => {
                    document.getElementById('documents-table-body').innerHTML = 
                        '<tr><td colspan="4" class="text-center">Error loading documents</td></tr>';
                    showToast('Error loading documents: ' + error.message, 'error');
                });
            }
            
            // Edit document
            function editDocument(courseName, filename) {
                fetch(`/api/courses/${encodeURIComponent(courseName)}/documents/${encodeURIComponent(filename)}`)
                .then(response => response.json())
                .then(doc => {
                    if (doc.content !== undefined) {
                        document.getElementById('document-modal-title').textContent = 'Edit Document';
                        document.getElementById('document-name').value = filename.replace(/\.md$/, '');
                        document.getElementById('document-content').value = doc.content;
                        document.getElementById('document-id').value = filename;
                        document.getElementById('document-course').value = courseName;
                        document.getElementById('document-modal').style.display = 'flex';
                    } else {
                        showToast('Error loading document', 'error');
                    }
                })
                .catch(error => {
                    showToast('Error loading document: ' + error.message, 'error');
                });
            }
            
            // Delete document
            function deleteDocument(courseName, filename) {
                if (confirm(`Are you sure you want to delete the document "${filename}"?`)) {
                    fetch(`/api/courses/${encodeURIComponent(courseName)}/documents/${encodeURIComponent(filename)}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message) {
                            loadDocuments(courseName);
                            showToast('Document deleted successfully', 'success');
                        } else {
                            showToast('Error: ' + (data.error || 'Could not delete document'), 'error');
                        }
                    })
                    .catch(error => {
                        showToast('Error: ' + error.message, 'error');
                    });
                }
            }
            
            // Update stats
            function updateStats() {
                // In a real implementation, you would update the stats dynamically
                // For now, we rely on the server-side rendering
            }
            
            // Drag and drop functionality for courses
            const coursesTable = document.getElementById('courses-table-body');
            if (coursesTable) {
                let draggedRow = null;
                
                coursesTable.addEventListener('dragstart', function(e) {
                    if (e.target.classList.contains('draggable-course')) {
                        draggedRow = e.target;
                        e.target.style.opacity = '0.5';
                    }
                });
                
                coursesTable.addEventListener('dragend', function(e) {
                    if (e.target.classList.contains('draggable-course')) {
                        e.target.style.opacity = '1';
                        draggedRow = null;
                    }
                });
                
                coursesTable.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                coursesTable.addEventListener('dragenter', function(e) {
                    if (e.target.classList.contains('draggable-course') && e.target !== draggedRow) {
                        e.target.style.backgroundColor = 'var(--tertiary-bg)';
                    }
                });
                
                coursesTable.addEventListener('dragleave', function(e) {
                    if (e.target.classList.contains('draggable-course')) {
                        e.target.style.backgroundColor = '';
                    }
                });
                
                coursesTable.addEventListener('drop', function(e) {
                    e.preventDefault();
                    if (e.target.classList.contains('draggable-course') && draggedRow) {
                        e.target.style.backgroundColor = '';
                        // In a real implementation, you would send a request to reorder courses
                        showToast('Course order updated', 'success');
                    }
                });
            }
            
            // Drag and drop for document import
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const browseFilesBtn = document.getElementById('browse-files');
            const importProgress = document.getElementById('import-progress');
            
            if (dropArea && fileInput && browseFilesBtn) {
                // Prevent default drag behaviors
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, preventDefaults, false);
                    document.body.addEventListener(eventName, preventDefaults, false);
                });
                
                // Highlight drop area when item is dragged over it
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, unhighlight, false);
                });
                
                // Handle dropped files
                dropArea.addEventListener('drop', handleDrop, false);
                
                // Handle file selection via button
                browseFilesBtn.addEventListener('click', function() {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', function() {
                    handleFiles(this.files);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                function highlight() {
                    dropArea.style.backgroundColor = 'var(--tertiary-bg)';
                    dropArea.style.borderColor = 'var(--accent-secondary)';
                }
                
                function unhighlight() {
                    dropArea.style.backgroundColor = '';
                    dropArea.style.borderColor = '';
                }
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    handleFiles(files);
                }
                
                function handleFiles(files) {
                    if (files.length === 0) return;
                    
                    // Show progress indicator
                    importProgress.style.display = 'block';
                    
                    // In a real implementation, you would upload and process the files
                    // For now, we'll just simulate the process
                    setTimeout(() => {
                        importProgress.style.display = 'none';
                        showToast(`${files.length} document(s) imported successfully`, 'success');
                    }, 2000);
                }
            }
        });
        
        // Toast notifications
        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container') || 
                (() => {
                    const container = document.createElement('div');
                    container.className = 'toast-container';
                    document.body.appendChild(container);
                    return container;
                })();
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = '‚ÑπÔ∏è';
            if (type === 'success') icon = '‚úÖ';
            if (type === 'error') icon = '‚ùå';
            
            toast.innerHTML = `
                <span class="toast-icon">${icon}</span>
                <div class="toast-content">${message}</div>
                <button class="toast-close">&times;</button>
            `;
            
            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.addEventListener('click', () => {
                toast.remove();
            });
            
            toastContainer.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>